---
title: "ContactMatrixSplit"
format: html
---

```{r}
# load packages and functions
source("packages.R")
source("functions.R")
```

```{r}

generate_matrix(assort = 1,number_of_quantiles = 3)->M
# works
```

##Calculate the eigenvalues

```{r}
matrix_to_eigenvalue(M,eigen_value=1)
```


```{r}
plan(multisession, workers = 12)

map_to_eigen(assort = 1, number_of_quantiles = 3)

expand_grid(Assort = seq(0,1,0.1),Bins = seq(1,10,1))|> 
  mutate(tmp = map2(Assort,Bins, ~map_to_eigen(assort = .x, number_of_quantiles = .y))) |> 
  unnest(tmp)->Output

Output |> 
  select(Assort,Bins,Eigenvalue=tmp) |> 
  mutate(Bins = as_factor(Bins))|> 
  ggplot(aes(x=Assort,y=Eigenvalue,colour = Bins))+
  geom_line()+
  geom_point()+
  xlab('Assortativity')
  
```
## Better figure



Scale of the issues
```{r}
expand_grid(Assort = seq(0,1,0.1),Bins = seq(1,100,1))|> 
  mutate(tmp = future_map2(Assort,Bins, ~map_to_eigen(assort = .x, number_of_quantiles = .y))) |> 
  unnest(tmp)->Output

Output |> 
  select(Assort,Bins,Eigenvalue=tmp) |> 
  mutate(Bins = as_factor(Bins))|> 
  ggplot(aes(x=Assort,y=Eigenvalue,colour = Bins))+
  geom_line()+
  geom_point()+
  xlab('Assortativity')+
  theme_minimal_grid()

```

#Effect of R

```{r}

```

